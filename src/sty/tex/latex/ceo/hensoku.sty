%これはframed.styを改変したものです．
%変則2段組などに使用するために改変してあります．
%2006.8.27

\ProvidesPackage{hensoku}
\newlength\pcolumnseprule
\setlength{\pcolumnseprule}{0pt}
\def\tatekeisenred{\textcolor{red}{\vrule \@width\pcolumnseprule}}
\def\tatekeisenbrack{\vrule \@width\pcolumnseprule}
\def\tatekeisen{\tatekeisenbrack}

\newenvironment{framed}% using default \FrameCommand
  {\MakeFramed {\advance\hsize-\width \FrameRestore}}%
  {\endMakeFramed}

\newenvironment{shaded}{%
  \def\FrameCommand{\colorbox{shadecolor}}%
  \MakeFramed {\FrameRestore}}%
 {\endMakeFramed}

\newenvironment{nobar}[1]{%
  \def\FrameCommand{\hspace{-#1}}%
  \MakeFramed {\advance\hsize-\width\advance\hsize-#1\FrameRestore}}%
 {\endMakeFramed}

\newenvironment{redleftbar}[1]{%
  \def\FrameCommand{\hspace{-#1}\textcolor{red}{\vrule width 2pt \hspace{5pt}}}%
  \MakeFramed {\advance\hsize-\width\advance\hsize-#1\FrameRestore}}%
 {\endMakeFramed}

\newenvironment{leftbar}{%
  \def\FrameCommand{\vrule width 3pt \hspace{10pt}}%
  \MakeFramed {\advance\hsize-\width \FrameRestore}}%
 {\endMakeFramed}

\newenvironment{blackleftbar}[1]{%
  \def\FrameCommand{\hspace{-#1}\vrule width 2pt \hspace{5pt}}%
  \MakeFramed {\advance\hsize-\width\advance\hsize-#1\FrameRestore}}%
 {\endMakeFramed}

\chardef\FrameRestore=\catcode`\| % for debug
\catcode`\|=\catcode`\% % (debug: insert space after backslash)

\def\MakeFramed#1{\par
 % measure added width and height; call result \width and \height
 \setbox\z@\vbox{\vskip-1in \hbox{\hskip-1in 
   \FrameCommand{\hbox{\vrule \@height .7in \@depth.3in \@width 1in}}}%
   \vskip\z@skip}%
 \def\width{\wd\z@}\def\height{\ht\z@}%
 \edef\fb@frw{\the\width}\edef\fb@frh{\the\height}%
 % insert pre-penalties and skips
 \begingroup
 \skip@\lastskip
 \if@nobreak\else 
    \penalty9999 % updates \page parameters
    \ifdim\pagefilstretch=\z@ \ifdim\pagefillstretch=\z@
       \edef\@tempa{\the\skip@}%
       \ifx\@tempa\zero@glue \penalty-30
       \else \vskip-\skip@ \penalty-30 \vskip\skip@
    \fi\fi\fi
    \penalty\z@
    % Give a stretchy breakpoint that will always be taken in preference
    % to the \penalty 9999 used to update page parameters.  The cube root
    % of 10000/100 indicates a multiplier of 0.21545, but the maximum 
    % calculated badness is really 8192, not 10000, so the multiplier
    % is 0.2301. 
    \advance\skip@ \z@ plus-.5\baselineskip
    \advance\skip@ \z@ plus-.231\height
    \advance\skip@ \z@ plus-.231\skip@
    \advance\skip@ \z@ plus-.231\topsep
    \vskip-\skip@ \penalty 1800 \vskip\skip@
 \fi
 \addvspace{\topsep}%
 \endgroup
 % clear out pending page break
 \penalty\@M \vskip 2\baselineskip \vskip\height
 \penalty9999 \vskip -2\baselineskip \vskip-\height
 \penalty9999 % updates \pagetotal
|\message{After clearout, \pagetotal=\the\pagetotal, \pagegoal=\the\pagegoal. }%
 \fb@adjheight 
 \setbox\@tempboxa\vbox\bgroup
   #1% Modifications to \hsize (can use \width and \height)
   \textwidth\hsize \columnwidth\hsize
}

\def\endMakeFramed{\par
     \kern\z@ \penalty-100 % put depth into height
 \egroup
 \begingroup \put@frame \endgroup
}

% \put@frame takes the contents of \@tempboxa and puts all, or a piece,
% of it on the page with a frame (\FrameCommand).  It recurses until
% all of \@tempboxa has been used up. (\@tempboxa must have zero depth.)

\def\put@frame{\relax
 \ifdim\pagegoal=\maxdimen \pagegoal\vsize \fi
|   \message{=============== Entering putframe ====================^^J
|     \pagegoal=\the\pagegoal,  \pagetotal=\the\pagetotal. }%
 \ifinner \else
    \dimen@\pagegoal \advance\dimen@-\pagetotal % natural space left on page
  \ifdim\dimen@<2\baselineskip 
|   \message{Page has only \the\dimen@\space room left; eject. }%
    \eject \fb@adjheight \put@frame
  \else % there's appreciable room left on the page
|    \message{\string\pagetotal=\the\pagetotal,
|        \string\pagegoal=\the\pagegoal, 
|        \string\pagestretch=\the\pagestretch,
|        \string\pageshrink=\the\pageshrink,
|        \string\fb@frh=\fb@frh. \space}
|    \message{Box of size \the\ht\@tempboxa\space + \fb@frh}%
     \begingroup % temporarily set \dimen@ to be...
     \advance\dimen@.8\pageshrink  % maximum space available on page
     \advance\dimen@-\fb@frh\relax % space available for frame's contents
     \expandafter\endgroup
     % restore \dimen@ to real room left on page
     \ifdim\dimen@>\ht\@tempboxa % whole box does fit
|       \message{fits in \the\dimen@. }%
     \else % box must be split
|       \message{must be split to fit in \the\dimen@. }%
        \setbox\@tempboxa\vbox{% simulate frame and flexiblity of the page:
           \vskip \fb@frh \@plus\pagestretch \@minus.8\pageshrink
           \kern137sp\kern-137sp\penalty-30
           \unvbox\@tempboxa}%
        \edef\fb@resto@set{\boxmaxdepth\the\boxmaxdepth \splittopskip\the\splittopskip}%
        \boxmaxdepth\z@ \splittopskip\z@
        \setbox\tw@\vsplit\@tempboxa to\dimen@
        \setbox\tw@\vbox{\unvbox\tw@}% natural-sized
|       \message{Box of size \the\ht\@tempboxa\space split to \the\dimen@. 
|          Natural height of split box is \the\ht\tw@. }%
        % If the split-to size > (\vsize-\topskip), then set box to full size
        \begingroup
          \advance\dimen@\topskip
          \expandafter\endgroup
        \ifdim\dimen@>\pagegoal
|         \message{Frame is big -- Use up the full column. }%
          \dimen@ii\pagegoal
          \advance\dimen@ii -\topskip
          \advance\dimen@ii \FrameHeightAdjust\relax
        \else  % suspect this is wrong:
          % If the split-to size > feasible room_on_page, rebox it smaller.
          \advance\dimen@.8\pageshrink
          \ifdim\ht\tw@>\dimen@
|           \message{Box too tall; rebox it to \the\dimen@. }%
            \dimen@ii\dimen@
          \else % use natural size
            \dimen@ii\ht\tw@
          \fi
        \fi
        % Re-box contents to desired size \dimen@ii
        \advance\dimen@ii -\fb@frh
        \setbox\tw@\vbox to\dimen@ii \bgroup
        % remove simulated frame and page flexibility:
        \vskip -\fb@frh \@plus-\pagestretch \@minus-.8\pageshrink
        \unvbox\tw@ \unpenalty\unpenalty
        \ifdim\lastkern=-137sp % whole box went to next page
|          \message{box split at beginning! }%
           \egroup \fb@resto@set \eject % (\vskip for frame size was discarded) 
           \fb@adjheight
        \else %
           \egroup \fb@resto@set
           \ifvoid\@tempboxa % it all fit after all
|             \message{box split at end! }%
              \setbox\@tempboxa\box\tw@
           \else % it really did split
|             \message{box split as expected. Its reboxed height is \the\ht\tw@. }%
              \ifdim\wd\tw@>\z@
                \centerline{\FrameCommand{\box\tw@}}%  ??? \centerline bad idea
              \else
|               \message{Zero width means likely blank. Don't frame it (guess)}%
                \box\tw@
              \fi
              \hrule \@height\z@
              \eject
              \fb@adjheight
              \put@frame
  \fi\fi\fi\fi\fi
  \ifvoid\@tempboxa\else
    \centerline{\FrameCommand{\box\@tempboxa}}%
    \nointerlineskip \null %{\showoutput \showlists}
    \penalty-30 \vskip\topsep
  \fi}

\def\fb@adjheight{%
  \vbox to\FrameHeightAdjust{}% get proper baseline skip from above.
  \penalty\@M \nointerlineskip
  \vskip-\FrameHeightAdjust
  \penalty\@M} % useful for tops of pages

\edef\zero@glue{\the\z@skip}

\catcode`\|=\FrameRestore

% Provide configuration commands:
\providecommand\FrameCommand{\fboxrule=\FrameRule \fboxsep=\FrameSep \fbox}
\@ifundefined{FrameRule}{\newdimen\FrameRule \FrameRule=\fboxrule}{}
\@ifundefined{FrameSep} {\newdimen\FrameSep  \FrameSep =3\fboxsep}{}

% Height of frame above first baseline when frame starts a page:
\providecommand\FrameHeightAdjust{6pt}

% \FrameRestore has parts of \@parboxrestore.  See how it is used in the 
% "settings" argument of \MakeFrame.  Previous behavior can be restored by 
% using \@parboxrestore there, or redefining:
% \makeatletter \renewcommand\FrameRestore{\@parboxrestore} \makeatother
\def\FrameRestore{%
  \let\if@nobreak\iffalse
  \let\if@noskipsec\iffalse
%  \let\par\@@par  ??
  \let\-\@dischyph
  \let\'\@acci\let\`\@accii\let\=\@acciii
%  \parindent\z@ \parskip\z@skip    Definitely omit!
%  \everypar{}%  ??
  \linewidth\hsize
%  \@totalleftmargin\z@
%  \leftskip\z@skip \rightskip\z@skip \@rightskip\z@skip
%  \parfillskip\@flushglue \lineskip\normallineskip
%  \baselineskip\normalbaselineskip
  \sloppy
%  \let\\\@normalcr
}

%  Compatibility with previous versions (temporary!):
\let\fram@d=\MakeFramed  \let\endfram@d=\endMakeFramed

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 右はみ出し
%  \hamidasi{本文を書く}{文字数\zw}
      
\def\hamidasiaki{2\zw}

\def\hamidasi#1#2{%
\def\@BUN{\begin{minipage}{#2}
#1
\end{minipage}}
\settoheight{\dimen1}{$\@BUN$}
\advance\dimen1 -0.5\baselineskip
\hfill\smash{\raisebox{-\dimen1}[0pt][0pt]{%
\makebox[0mm][l]{\hskip\hamidasiaki\@BUN}}}}


\def\hhamidasi#1#2#3#4{%
\def\@BUN{\begin{minipage}{#2}
#1
\end{minipage}}
\hfill\smash{\raisebox{-#3\baselineskip}[0pt][0pt]{%
\makebox[0mm][l]{\hskip\hamidasiaki\hskip#4\@BUN}}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 右はみ出し（方式が違う）
%  \yhamidasi{本文を書く}{はみ出し文字幅\zw}% 
%  \yyhamidasi{本文を書く}{文字幅\zw}{上下移動行数}{右移動幅\zw}         
\def\hamidasiaki{2\zw}
\def\yhamidasi#1#2{%
  \par %
  \begingroup\clubpenalty=10000
  \def\par{\endgraf\endgroup}%
  \noindent
\def\@BUN{\begin{minipage}{#2}
#1
\end{minipage}}%
\settoheight{\dimen1}{$\@BUN$}
\advance\dimen1 -1.5\baselineskip
	\raisebox{-\dimen1}[0pt][0pt]{%
    \hbox to 0pt{\hskip\linewidth\hskip\hamidasiaki{\@BUN}\hss}}}
    
\def\yyhamidasi#1#2#3#4{%
  \par %
  \begingroup\clubpenalty=10000
  \def\par{\endgraf\endgroup}%
  \noindent
\def\@BUN{\begin{minipage}{#2}
#1
\end{minipage}}%
	\raisebox{-#3\baselineskip}[0pt][0pt]{%
    \hbox to 0pt{\hskip\linewidth\hskip\hamidasiaki\hskip#4{\@BUN}\hss}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% This is file `parallel.sty'
%

\newdimen\ParallelLWidth
\newdimen\ParallelRWidth
\newdimen\ParallelTextWidth
\newdimen\ParallelLeftMargin
\newdimen\ParallelUserMidSkip
\newdimen\ParallelMainMidSkip
\newbox\ParallelLBox
\newbox\ParallelRBox
\newbox\ParallelBoxVar
\newbox\ParallelLTok
\newbox\ParallelRTok
\newcount\ParallelBoolVar
\newcount\ParallelBoolMid
\newcount\ParallelWhichBox
\newcount\ParallelMainMode
\newcount\ParallelFNMode
\newcount\ParallelLFNCounter
\newcount\ParallelRFNCounter
\newcount\ParallelMaxFN
\newcount\ParallelFNNumMode
\newcommand{\ParallelMessage}[1]{\relax}
\DeclareOption{Verbose}{%
  \renewcommand{\ParallelMessage}[1]{\message{#1}}
  \message{Verbose}
}
\DeclareOption{OldStyleNums}{%
  \ParallelFNNumMode=1\ParallelMessage{OldStyleNums}}
\DeclareOption{RaiseNums}{%
  \ParallelFNNumMode=2\ParallelMessage{RaiseNums}}
\DeclareOption{ItalicNums}{%
  \ParallelFNNumMode=3\ParallelMessage{ItalicNums}}
\DeclareOption{RomanNums}{%
  \ParallelFNNumMode=4\ParallelMessage{RomanNums}}
\DeclareOption{SeparatedFootnotes}{%
  \ParallelFNMode=1\ParallelMessage{SeparatedFootnotes}}
\newcommand{\ParallelLFootnote}[1]{%
  \global\advance\ParallelLFNCounter\@ne
  \footnotemark[\number\ParallelLFNCounter]%
  \expandafter\gdef%
    \csname ParallelLFN\romannumeral\ParallelLFNCounter\endcsname{#1}}
\newcommand{\ParallelRFootnote}[1]{%
  \global\advance\ParallelRFNCounter\@ne
  \footnotemark[\number\ParallelRFNCounter]%
  \expandafter\gdef%
    \csname ParallelRFN\romannumeral\ParallelRFNCounter\endcsname{#1}}
\newenvironment{ParallelFNEnviron}{%
  \footnotesize
  \begin{list}{}{%
    \leftmargin=4em \rightmargin=\z@
    \topsep=\z@skip \itemsep=\z@skip
    \labelwidth=3em \labelsep=1em%
    \renewcommand{\makelabel}[1]{{\hfill\footnotesize ##1}}%
    }%
}{%
  \end{list}%
}
\newcommand{\ParallelShowFNList}{%
  % footnotes in left or right column, i.e. left+right>0?
  \ParallelMaxFN=\ParallelLFNCounter
  \advance\ParallelMaxFN \ParallelRFNCounter
  \ifnum\ParallelMaxFN>\z@
    \ParallelMessage{Parallel Footnotes (}%
    \begin{ParallelFNEnviron}%
      \ParallelMaxFN=\ParallelLFNCounter
      \global\ParallelLFNCounter=\z@
      \loop
        \ifnum\ParallelLFNCounter<\ParallelMaxFN
          \global\advance\ParallelLFNCounter \@ne
          \item[\ifcase\ParallelFNNumMode \number\ParallelLFNCounter%
                \or \oldstylenums{\the\ParallelLFNCounter}%
                \or \raisebox{1ex}{\the\ParallelLFNCounter}%
                \or \textit{\number\ParallelLFNCounter}%
                \or \romannumeral\ParallelLFNCounter%
                \else  \number\ParallelLFNCounter \fi]%
            \par
            {\csname ParallelLFN\romannumeral\ParallelLFNCounter\endcsname}%
            \par
      \repeat
    \end{ParallelFNEnviron}%
    \ifnum\ParallelFNMode=\@ne
      \begin{ParallelFNEnviron}%
        \ParallelMaxFN=\ParallelRFNCounter
        \global\ParallelRFNCounter=\z@
        \loop
          \ifnum\ParallelRFNCounter<\ParallelMaxFN
            \global\advance\ParallelRFNCounter \@ne
            \item[\ifcase\ParallelFNNumMode
                     \number\ParallelRFNCounter\ParallelDot
                  \or \oldstylenums{\the\ParallelRFNCounter}\ParallelDot
                  \or \raisebox{1ex}{\the\ParallelRFNCounter\ParallelDot}%
                  \or \textit{\number\ParallelRFNCounter\ParallelDot}%
                  \or \romannumeral\ParallelLFNCounter%
                  \else \number\ParallelRFNCounter\ParallelDot \fi]%
              \par
              {\csname ParallelRFN\romannumeral\ParallelRFNCounter\endcsname}%
              \par
        \repeat
      \end{ParallelFNEnviron}%
    \fi
    \global\ParallelLFNCounter=\z@
    \global\ParallelRFNCounter=\z@
    \ParallelMessage{)}%
  \else
    \ParallelMessage{No Parallel Footnotes}%
  \fi
}
\def\ParallelParOnePage{%
  \ifnum\ParallelBoolVar=\@ne
    \par\begingroup
    \leftmargin=\z@ \rightmargin=\z@
    \parskip=\z@skip \parindent=\z@
    \lineskiplimit\z@ \lineskip\z@ %%% この設定を追加
    \vbadness=10000
    \vfuzz=3ex
    \splittopskip=\z@skip
    \loop%
      \ifnum\ParallelBoolVar=\@ne%
        \noindent
        \hbox to\textwidth{%
          \hskip\ParallelLeftMargin
          \hbox to\ParallelTextWidth{%
            \ifvoid\ParallelLBox
              \hskip\ParallelLWidth
            \else
              \ParallelWhichBox=\z@
              \vbox{\setbox\ParallelBoxVar
                    =\vsplit\ParallelLBox to\dp\strutbox%
                    \unvbox\ParallelBoxVar}%
            \fi
            \strut
            \ifnum\ParallelBoolMid=\@ne
              \hskip\ParallelMainMidSkip
              \tatekeisen   %%% ここが段間罫線定義変更です
%             \vrule \@width\pcolumnseprule %%% ここは段間罫線の太さの変更
            \else
              \hss
            \fi
            \hss
            \ifvoid\ParallelRBox
              \hskip\ParallelRWidth
            \else
              \ParallelWhichBox=\@ne
              \vbox{\setbox\ParallelBoxVar
                    =\vsplit\ParallelRBox to\dp\strutbox%
                    \unvbox\ParallelBoxVar}%
            \fi}}%
        \ifvoid\ParallelLBox \ifvoid\ParallelRBox
          \global\ParallelBoolVar=\z@
        \fi\fi%
      \fi%
      \ifnum\ParallelBoolVar=\@ne%
         \penalty\interlinepenalty
    \repeat
    \par
    \endgroup
  \fi}
\newcommand{\ParallelParTwoPages}{%
  \ifnum\ParallelBoolVar=\@ne
    \par\begingroup
    \global\ParallelWhichBox=\@ne
    \newpage
    \vbadness=10000
    \vfuzz=3ex
    \splittopskip=\z@skip
    \loop%
      \ifnum\ParallelBoolVar=\@ne%
        \ifnum\ParallelWhichBox=\@ne
          \ifvoid\ParallelLBox \mbox{} \newpage
          \else\global\ParallelWhichBox=\z@\fi
        \else
          \ifvoid\ParallelRBox \mbox{} \newpage
          \else\global\ParallelWhichBox=\@ne\fi
        \fi
        \ifnum\ParallelWhichBox=\z@
          \ifodd\thepage \mbox{} \newpage \fi
          \hbox to\textwidth{%
            \vbox{\vsplit\ParallelLBox to.98\textheight}}%
        \else
          \ifodd\thepage\relax\else \mbox{} \newpage \fi
          \hbox to\textwidth{%
            \vbox{\vsplit\ParallelRBox to.98\textheight}}%
        \fi
        \vspace*{\fill}\newpage
      \fi
      \ifvoid\ParallelLBox\ifvoid\ParallelRBox
        \global\ParallelBoolVar=\z@
      \fi\fi
      \ifnum\ParallelBoolVar=\@ne
    \repeat
    \par
    \endgroup
  \fi}
\newcommand{\ParallelAfterText}{%
  \global\ParallelBoolVar=\@ne
  \let\footnote=\ParallelOldFootnote\endgroup}
\newcommand{\ParallelCheckOpenBrace}{%
  \ifx\x\bgroup \else
    \errmessage{Missing opening brace}%
  \fi
  \endgroup}
\newcommand{\ParallelLText}{%
%  \everypar{}
\clubpenalty\@clubpenalty
\@restorepar\begingroup
  \hbadness=3000
  \let\footnote=\ParallelLFootnote
  \ParallelWhichBox=0
  \global\setbox\ParallelLBox=\vbox\bgroup \hsize=\ParallelLWidth
  \aftergroup\ParallelAfterText
  \begingroup \afterassignment\ParallelCheckOpenBrace \let\x=}
\newcommand{\ParallelRText}{%
  \everypar{}\@restorepar\begingroup
  \hbadness=3000
  \ifnum\ParallelFNMode=\@ne
    \let\footnote=\ParallelRFootnote
  \else
    \let\footnote=\ParallelLFootnote
  \fi
  \ParallelWhichBox=\@ne
  \global\setbox\ParallelRBox=\vbox\bgroup \hsize=\ParallelRWidth
  \aftergroup\ParallelAfterText
  \begingroup \afterassignment\ParallelCheckOpenBrace \let\x=}
\newcommand{\ParallelAtEnd}{}
\newcommand{\ParallelPar}{}  % Dummy
\newcommand{\ParallelDot}{\ensuremath{\cdot}}
\newenvironment{Parallel}[3][c]{%
  \begingroup%
    \ParallelTextWidth=\linewidth
    \ParallelLeftMargin=\textwidth
    \advance\ParallelLeftMargin by-\linewidth
    \if #1p\relax
      \ParallelMessage{ on Pages (}%
      \ParallelMainMode=\z@
      \renewcommand{\ParallelPar}{\ParallelParTwoPages}
    \else
      \if #1a\relax
        \ParallelMessage{ autocomputed Pages (}%
        \ParallelMainMode=\tw@
        \renewcommand{\ParallelPar}{\ParallelParTwoPages}
      \else
        \tolerance=600         % sorry, but neccessary
        \emergencystretch=.5em % dto.
        \ParallelMainMode=\@ne
        \renewcommand{\ParallelPar}{\ParallelParOnePage}
        \if #1v\relax
          \ParallelBoolMid=\@ne
          \ParallelMessage{ in Columns, with VLine (}%
        \else
          \if #1c\relax\else
            \errhelp{possible options:
            'p'age, 'c'olumn or columns with 'v'line ---
            type <return> to proceed in column-mode}
            \errmessage{bad option '#1' to environment 'Parallel'}
          \fi
          \ParallelMessage{ in Columns (}%
    \fi\fi\fi
    \def\ParallelArgL{#2} \def\ParallelArgR{#3}
    \ifx\ParallelArgL\empty\ParallelLWidth=0in\else\ifx\ParallelArgL\space
        \ParallelLWidth=0in\else\setlength\ParallelLWidth{#2}\fi\fi
    \ifx\ParallelArgR\empty\ParallelRWidth=0in\else\ifx\ParallelArgR\space
        \ParallelRWidth=0in\else\setlength\ParallelRWidth{#3}\fi\fi
    \ifnum\ParallelMainMode=\@ne
      \ifdim\ParallelLWidth>1em
        \ifdim\ParallelRWidth>1em
          \ParallelMainMidSkip=\linewidth
          \advance\ParallelMainMidSkip by-\ParallelLWidth
          \advance\ParallelMainMidSkip by-\ParallelRWidth
          \advance\ParallelMainMidSkip by-.5pt
          \advance\ParallelMainMidSkip by-\ParallelLeftMargin
          \divide\ParallelMainMidSkip by 2
        \else
          \ParallelRWidth=\linewidth
          \advance\ParallelRWidth by-\ParallelLWidth
          \advance\ParallelRWidth by-2\ParallelUserMidSkip
          \advance\ParallelRWidth by-\ParallelLeftMargin
          \ParallelMainMidSkip=\ParallelUserMidSkip
        \fi
      \else
        \ifdim\ParallelRWidth>1em
          \ParallelLWidth=\linewidth
          \advance\ParallelLWidth by-\ParallelRWidth
          \advance\ParallelLWidth by-2\ParallelUserMidSkip
          \advance\ParallelLWidth by-\ParallelLeftMargin
          \ParallelMainMidSkip=\ParallelUserMidSkip
        \else
          \ParallelLWidth=.5\linewidth
          \advance\ParallelLWidth by-\ParallelLeftMargin
          \advance\ParallelLWidth by-\ParallelUserMidSkip
          \ParallelRWidth=\ParallelLWidth
          \ParallelMainMidSkip=\ParallelUserMidSkip
        \fi
      \fi
    \else
      \ifdim\ParallelLWidth>1em
        \ifdim\ParallelRWidth>1em
        \else
          \ParallelRWidth=\linewidth
          \advance\ParallelRWidth by-\ParallelLeftMargin
        \fi
      \else
        \ifdim\ParallelRWidth>1em
          \ParallelLWidth=\linewidth
          \advance\ParallelLWidth by-\ParallelLeftMargin
        \else
          \ParallelLWidth=\linewidth
          \advance\ParallelLWidth by-\ParallelLeftMargin
          \ParallelRWidth=\linewidth
          \advance\ParallelRWidth by-\ParallelLeftMargin
        \fi
      \fi
    \fi
    \global\ParallelLFNCounter=\z@
    \global\ParallelRFNCounter=\z@
    \let\ParallelOldFootnote=\footnote
}{%
    \ParallelPar%
    \ParallelAtEnd%
  \endgroup%
  \ParallelShowFNList%
  \let\footnote=\ParallelOldFootnote
  \ParallelMessage{)}}
\ParallelFNNumMode=\z@
\ParallelFNMode=\z@
\ParallelBoolMid=\z@
\ParallelUserMidSkip=.5em
\ProcessOptions
\endinput

